# Docker Composeæ–‡ä»¶æ›¿æ¢å®Œæˆè¯´æ˜

## ğŸ“‹ æ›¿æ¢æ€»ç»“

æˆåŠŸå°† `docker-compose.v2.1.yml` æ›¿æ¢ä¸ºæ ‡å‡†çš„ `docker-compose.yml` æ–‡ä»¶ã€‚

## ğŸ”„ æ–‡ä»¶å˜æ›´

### æ›¿æ¢å‰:
```
â”œâ”€â”€ docker-compose.yml (v2.0 - åŸºç¡€ç‰ˆ)
â”œâ”€â”€ docker-compose.v2.1.yml (v2.1 - å®Œæ•´ç‰ˆ)
```

### æ›¿æ¢å:
```
â”œâ”€â”€ docker-compose.yml (v2.1 - ç°åœ¨æ˜¯ä¸»æ–‡ä»¶)
â”œâ”€â”€ docker-compose.v2.0.backup.yml (v2.0 - å¤‡ä»½æ–‡ä»¶)
```

## âœ… å®Œæˆçš„ä¿®æ”¹

### 1. æ–‡ä»¶æ›¿æ¢
- âœ… å¤‡ä»½åŸæœ‰v2.0æ–‡ä»¶ä¸º `docker-compose.v2.0.backup.yml`
- âœ… å°†v2.1æ–‡ä»¶é‡å‘½åä¸ºæ ‡å‡†çš„ `docker-compose.yml`
- âœ… åˆ é™¤å¤šä½™çš„v2.1æ–‡ä»¶

### 2. é…ç½®ä¿®å¤
- âœ… ä¿®å¤ç¯å¢ƒå˜é‡ç±»å‹ (å¸ƒå°”å€¼æ”¹ä¸ºå­—ç¬¦ä¸²)
- âœ… å‡çº§Docker Composeç‰ˆæœ¬ä¸º3.9
- âœ… ç§»é™¤ä¸å…¼å®¹çš„profilesé…ç½®
- âœ… ä¿æŒå®Œæ•´çš„æœåŠ¡å®šä¹‰

### 3. è„šæœ¬æ›´æ–°
- âœ… æ›´æ–° `deploy.sh` ä¸­çš„æ–‡ä»¶å¼•ç”¨
- âœ… ä¿®æ”¹æœåŠ¡å¯åŠ¨é€»è¾‘ï¼Œä¸ä¾èµ–profiles
- âœ… ä¿æŒä¸åŒç¯å¢ƒçš„æœåŠ¡é€‰æ‹©åŠŸèƒ½

### 4. æ–‡æ¡£æ›´æ–°
- âœ… æ›´æ–°é¡¹ç›®æ–‡æ¡£ä¸­çš„æ–‡ä»¶å¼•ç”¨
- âœ… æ›´æ–°è®¾è®¡æ–‡æ¡£ä¸­çš„é…ç½®è¯´æ˜

## ğŸš€ æ–°çš„ä½¿ç”¨æ–¹å¼

### æ ‡å‡†Docker Composeå‘½ä»¤
```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# å¯åŠ¨ç‰¹å®šæœåŠ¡
docker-compose up -d postgres redis mcp-server web-ui

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f mcp-server
```

### ä½¿ç”¨éƒ¨ç½²è„šæœ¬ï¼ˆæ¨èï¼‰
```bash
# å¼€å‘ç¯å¢ƒ (4ä¸ªæ ¸å¿ƒæœåŠ¡)
./deploy.sh -e development up

# ç”Ÿäº§ç¯å¢ƒ (6ä¸ªå®Œæ•´æœåŠ¡)  
./deploy.sh -e production up

# æµ‹è¯•ç¯å¢ƒ (2ä¸ªåŸºç¡€æœåŠ¡)
./deploy.sh -e testing up

# æŸ¥çœ‹çŠ¶æ€
./deploy.sh -e production status
```

## ğŸ“Š æœåŠ¡é…ç½®

### å¼€å‘ç¯å¢ƒæœåŠ¡
- postgres (æ•°æ®åº“)
- redis (ç¼“å­˜) 
- mcp-server (æ ¸å¿ƒæœåŠ¡)
- web-ui (ç®¡ç†ç•Œé¢)

### ç”Ÿäº§ç¯å¢ƒæœåŠ¡
- postgres (æ•°æ®åº“)
- redis (ç¼“å­˜)
- mcp-server (æ ¸å¿ƒæœåŠ¡) 
- web-ui (ç®¡ç†ç•Œé¢)
- prometheus (ç›‘æ§)
- grafana (ä»ªè¡¨æ¿)

### æµ‹è¯•ç¯å¢ƒæœåŠ¡
- postgres (æ•°æ®åº“)
- redis (ç¼“å­˜)

## ğŸ”§ å…¼å®¹æ€§è¯´æ˜

### Docker Composeç‰ˆæœ¬è¦æ±‚
- **æ¨è**: Docker Compose 2.0+
- **æœ€ä½**: Docker Compose 1.29+
- **é…ç½®ç‰ˆæœ¬**: 3.9

### å‘ä¸‹å…¼å®¹
- âœ… ä¿æŒæ‰€æœ‰v2.0çš„åŠŸèƒ½ç‰¹æ€§
- âœ… æ”¯æŒv2.0çš„ç¯å¢ƒå˜é‡
- âœ… å…¼å®¹ç°æœ‰çš„éƒ¨ç½²å·¥ä½œæµ
- âœ… å¯ä»¥éšæ—¶å›æ»šåˆ°v2.0å¤‡ä»½æ–‡ä»¶

### å‘ä¸Šæ‰©å±•  
- âœ… æ”¯æŒå¤šä»£ç†è®¤è¯
- âœ… æ”¯æŒå¤šç«™ç‚¹å‘å¸ƒ
- âœ… æä¾›Webç®¡ç†ç•Œé¢
- âœ… åŒ…å«å®Œæ•´ç›‘æ§æ ˆ

## ğŸ’¡ ä½¿ç”¨å»ºè®®

1. **æ—¥å¸¸å¼€å‘**: ä½¿ç”¨ `./deploy.sh -e development up`
2. **ç”Ÿäº§éƒ¨ç½²**: ä½¿ç”¨ `./deploy.sh -e production up`
3. **å¿«é€Ÿæµ‹è¯•**: ä½¿ç”¨ `docker-compose up -d postgres redis mcp-server`
4. **å®Œæ•´åŠŸèƒ½**: ä½¿ç”¨ `docker-compose up -d` å¯åŠ¨æ‰€æœ‰æœåŠ¡

## ğŸ”„ å¦‚éœ€å›æ»š

å¦‚æœéœ€è¦å›æ»šåˆ°v2.0ç‰ˆæœ¬:
```bash
# åœæ­¢å½“å‰æœåŠ¡
docker-compose down

# æ¢å¤v2.0é…ç½®
mv docker-compose.yml docker-compose.v2.1.backup.yml
mv docker-compose.v2.0.backup.yml docker-compose.yml

# é‡æ–°å¯åŠ¨
docker-compose up -d
```

## ğŸ‰ æ›¿æ¢æ”¶ç›Š

1. **æ ‡å‡†åŒ–**: ä½¿ç”¨æ ‡å‡†çš„docker-compose.ymlæ–‡ä»¶å
2. **ç®€åŒ–**: åªéœ€ç»´æŠ¤ä¸€ä¸ªé…ç½®æ–‡ä»¶
3. **å…¼å®¹æ€§**: å®Œå…¨å‘ä¸‹å…¼å®¹v2.0åŠŸèƒ½
4. **æ‰©å±•æ€§**: åŒ…å«æ‰€æœ‰v2.1ä¼ä¸šçº§åŠŸèƒ½
5. **çµæ´»æ€§**: æ”¯æŒå¤šç§éƒ¨ç½²åœºæ™¯