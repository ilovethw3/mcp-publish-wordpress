# 需求文档：MCP WordPress发布服务器 v2.0

## 1. 简介

本项目旨在创建一个符合Model Context Protocol (MCP) 标准的服务器，用于AI驱动的WordPress内容发布工作流。该MCP服务器将提供Tools、Resources和Prompts，使AI客户端能够提交文章、管理审核流程，并自动发布到WordPress站点。

该系统完全遵循MCP协议规范，使用JSON-RPC 2.0消息格式和标准传输层（stdio/SSE），确保与MCP生态系统的完全兼容性。

## 2. 功能需求

### 2.1 MCP服务器基础架构

- **用户故事**: 作为一个MCP客户端，我希望能够连接到符合MCP协议的服务器，以便使用标准化的方式与WordPress发布服务交互。

- **验收标准**:
  1. **当** MCP客户端发起连接时，**则** 服务器 **必须** 使用JSON-RPC 2.0协议进行通信
  2. **当** 客户端请求服务器能力时，**则** 服务器 **必须** 返回正确的capabilities声明
  3. **当** 使用stdio传输时，**则** 服务器 **必须** 通过标准输入/输出进行通信
  4. **当** 使用SSE传输时，**则** 服务器 **必须** 支持Server-Sent Events

### 2.2 MCP Tools实现

- **用户故事**: 作为一个AI客户端，我希望通过MCP Tools提交和管理WordPress文章，以便实现自动化的内容发布流程。

- **验收标准**:
  1. **当** 客户端调用`submit_article` Tool时，**则** 服务器 **必须** 接收文章数据并设置状态为待审核
  2. **当** 客户端调用`list_articles` Tool时，**则** 服务器 **必须** 返回文章列表及其状态
  3. **当** 客户端调用`approve_article` Tool时，**则** 服务器 **必须** 启动WordPress发布流程
  4. **当** 客户端调用`reject_article` Tool时，**则** 服务器 **必须** 更新文章状态为已拒绝
  5. **当** 客户端调用`get_article_status` Tool时，**则** 服务器 **必须** 返回文章的当前发布状态

### 2.3 MCP Resources暴露

- **用户故事**: 作为一个AI客户端，我希望通过MCP Resources访问文章数据和元数据，以便进行内容分析和管理。

- **验收标准**:
  1. **当** 客户端请求`article://pending` Resource时，**则** 服务器 **必须** 返回待审核文章列表
  2. **当** 客户端请求`article://{id}` Resource时，**则** 服务器 **必须** 返回指定文章的完整内容
  3. **当** 客户端请求`wordpress://config` Resource时，**则** 服务器 **必须** 返回WordPress配置信息
  4. **当** 客户端请求`stats://summary` Resource时，**则** 服务器 **必须** 返回发布统计数据

### 2.4 MCP Prompts支持

- **用户故事**: 作为一个AI客户端，我希望获取标准化的提示模板，以便生成符合要求的文章内容。

- **验收标准**:
  1. **当** 客户端请求`article_template` Prompt时，**则** 服务器 **必须** 返回标准文章格式模板
  2. **当** 客户端请求`review_checklist` Prompt时，**则** 服务器 **必须** 返回审核清单模板
  3. **当** 客户端请求`wordpress_formatting` Prompt时，**则** 服务器 **必须** 返回WordPress格式化指南

### 2.5 传输层支持

- **用户故事**: 作为一个MCP客户端，我希望能够通过多种传输方式连接到服务器，以便在不同的部署环境中使用。

- **验收标准**:
  1. **当** 客户端通过stdio连接时，**则** 服务器 **必须** 正确处理标准输入/输出通信
  2. **当** 客户端通过SSE连接时，**则** 服务器 **必须** 支持HTTP Server-Sent Events
  3. **当** 服务器启动时，**则** 系统 **必须** 根据配置选择合适的传输方式
  4. **当** 传输连接断开时，**则** 服务器 **必须** 优雅地处理连接清理

### 2.6 WordPress集成

- **用户故事**: 作为系统管理员，我希望MCP服务器能够自动将批准的文章发布到WordPress，以便实现无缝的内容发布流程。

- **验收标准**:
  1. **当** 文章被批准时，**则** 系统 **必须** 使用WordPress REST API创建文章
  2. **当** WordPress发布成功时，**则** 系统 **必须** 更新文章状态并保存WordPress文章ID
  3. **当** WordPress发布失败时，**则** 系统 **必须** 记录错误信息并设置失败状态
  4. **当** 发布过程中断时，**则** 系统 **必须** 支持重试机制

### 2.7 认证与安全

- **用户故事**: 作为系统管理员，我希望MCP服务器具有安全的认证机制，以便保护内容发布流程免受未授权访问。

- **验收标准**:
  1. **当** AI客户端提交文章时，**则** 服务器 **必须** 验证API密钥
  2. **当** 人工审核员访问管理功能时，**则** 服务器 **必须** 验证JWT令牌
  3. **当** 认证失败时，**则** 服务器 **必须** 返回适当的错误消息
  4. **当** 存储密码时，**则** 系统 **必须** 使用安全的哈希算法

### 2.8 错误处理与日志

- **用户故事**: 作为开发者，我希望MCP服务器具有完善的错误处理和日志记录，以便快速诊断和解决问题。

- **验收标准**:
  1. **当** 发生错误时，**则** 服务器 **必须** 返回符合JSON-RPC 2.0规范的错误响应
  2. **当** 执行关键操作时，**则** 系统 **必须** 记录详细的操作日志
  3. **当** WordPress发布失败时，**则** 系统 **必须** 记录具体的错误原因
  4. **当** 系统异常时，**则** 服务器 **必须** 保持稳定并提供诊断信息

### 2.9 配置管理

- **用户故事**: 作为部署人员，我希望能够通过环境变量配置MCP服务器，以便在不同环境中灵活部署。

- **验收标准**:
  1. **当** 启动服务器时，**则** 系统 **必须** 从环境变量加载数据库连接信息
  2. **当** 配置WordPress集成时，**则** 系统 **必须** 从环境变量读取WordPress API凭据
  3. **当** 设置传输方式时，**则** 系统 **必须** 支持通过配置选择stdio或SSE
  4. **当** 配置缺失或无效时，**则** 系统 **必须** 提供清晰的错误提示

### 2.10 MCP协议兼容性

- **用户故事**: 作为MCP生态系统的一部分，我希望服务器完全符合MCP协议规范，以便与任何标准MCP客户端兼容。

- **验收标准**:
  1. **当** 客户端发送`initialize`请求时，**则** 服务器 **必须** 返回正确的协议版本和能力声明
  2. **当** 客户端调用`tools/list`时，**则** 服务器 **必须** 返回所有可用Tools的schema
  3. **当** 客户端调用`resources/list`时，**则** 服务器 **必须** 返回所有可用Resources
  4. **当** 客户端调用`prompts/list`时，**则** 服务器 **必须** 返回所有可用Prompts
  5. **当** 消息交换发生时，**则** 所有消息 **必须** 符合JSON-RPC 2.0格式规范